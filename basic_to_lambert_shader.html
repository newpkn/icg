<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <title>PBR + Sketchfab Model</title>
  <style>html,body{margin:0;height:100%} canvas{display:block}</style>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dat.gui/build/dat.gui.min.js"></script>
</head>
<body>
<script>
  // --- Scene ---
  const scene = new THREE.Scene();
  scene.background = new THREE.Color(0x222222);

  // --- Camera ---
  const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 100);
  camera.position.set(5, 3, 10);

  // --- Renderer ---
  const renderer = new THREE.WebGLRenderer({ antialias:true });
  renderer.setSize(innerWidth, innerHeight);
  renderer.outputEncoding = THREE.sRGBEncoding;
  document.body.appendChild(renderer.domElement);

  const controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.update();

  // --- Lights ---
  const light = new THREE.PointLight(0xffffff, 2);
  light.position.set(3, 3, 3);
  scene.add(light);

  const ambient = new THREE.AmbientLight(0xffffff, 1);
  scene.add(ambient);
  light.intensity = 2.5;

  const lightHelper = new THREE.PointLightHelper(light, 0.1);
  scene.add(lightHelper);

  // --- Ground Plane ---
  const plane = new THREE.Mesh(
    new THREE.PlaneGeometry(20, 20),
    new THREE.MeshStandardMaterial({ color:0x888888, metalness:0.0, roughness:0.4 })
  );
  plane.rotation.x = -Math.PI/2;
  scene.add(plane);

  // --- Load Textures with callback ---
  const texLoader = new THREE.TextureLoader();

  function loadTexture(path){
    return texLoader.load(
      path,
      () => { console.log(path + " loaded"); },
      undefined,
      (err) => { console.error(path + " failed", err); }
    );
  }

  const myTexture1 = loadTexture("textures/Frame4_1.jpeg");
  myTexture1.encoding = THREE.sRGBEncoding;

  const myTexture2 = loadTexture("textures/Frame228_0.jpeg");
  myTexture2.encoding = THREE.sRGBEncoding;

  const myTexture3 = loadTexture("textures/Image11_2.png");
  myTexture3.encoding = THREE.sRGBEncoding;

  const myTexture4 = loadTexture("textures/Image27_3.png");
  myTexture4.encoding = THREE.sRGBEncoding;

  // --- Load GLTF Model ---
  const loader = new THREE.GLTFLoader();
  loader.load("source/VOSSEN.glb", function(gltf) {
    const model = gltf.scene;

    model.traverse((child)=>{
      if(child.isMesh){
        if(child.name.includes("Body")){
          child.material = new THREE.MeshStandardMaterial({ map: myTexture1, metalness:0.5, roughness:0.4 });
        } else if(child.name.includes("Wheel")){
          child.material = new THREE.MeshStandardMaterial({ map: myTexture2, metalness:0.8, roughness:0.2 });
        } else if(child.name.includes("Glass")){
          child.material = new THREE.MeshStandardMaterial({ map: myTexture3, metalness:1.0, roughness:0.05, transparent:true, opacity:0.7 });
        } else {
          child.material = new THREE.MeshStandardMaterial({ map: myTexture4, metalness:0.4, roughness:0.6 });
        }
        child.castShadow = true;
        child.receiveShadow = true;
      }
    });

    model.scale.set(0.5,0.5,0.5);
    model.position.set(1,1,1);
    scene.add(model);
  });

  // --- GUI ---
  const gui = new dat.GUI();
  gui.add(light.position, "x", -10, 10);
  gui.add(light.position, "y", -10, 10);
  gui.add(light.position, "z", -10, 10);

  // --- Resize ---
  window.addEventListener("resize", ()=>{
    camera.aspect = innerWidth/innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(innerWidth, innerHeight);
  });

  // --- Animate ---
  function animate(){
    renderer.render(scene, camera);
    requestAnimationFrame(animate);
  }
  animate();
</script>
</body>
</html>
